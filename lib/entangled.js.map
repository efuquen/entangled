{"version":3,"sources":["entangled.js"],"names":[],"mappings":"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","file":"entangled.js","sourcesContent":["process.env.SUPPRESS_NO_CONFIG_WARNING = 'y';\nconst config     = require('config');\nconst toml       = require('toml');\nconst express    = require('express');\nconst _          = require('lodash');\nconst render     = require('mithril-node-render');\nconst util       = require('util');\nconst readFile   = require('fs-readfile-promise');\nconst bodyParser = require('body-parser');\nconst cookieParser = require('cookie-parser');\n\nconst EventEmitter = require('events').EventEmitter;\n\nrequire('toml-require').install();\n\nvar init = function(opts) {\n  initConfig(opts);\n\n  class Entangled {\n    constructor() {\n      this.cfg = config.get('entangled');\n      this.app = initExpress(this.cfg.express, opts);\n    }\n\n    start(cb) {\n      const hasPort = this.cfg.express && this.cfg.express.port;\n      const port = hasPort ? this.cfg.express.port : 3000;\n      return this.app.listen(port, cb);\n    }\n  }\n\n  return new Entangled();\n}\n\nfunction initConfig(opts) {\n  const defaultCfgs = require('../config/default.toml').entangled;\n  config.util.extendDeep(defaultCfgs, opts);\n  config.util.setModuleDefaults('entangled', defaultCfgs);\n}\n\nfunction initExpress(cfg, opts) {\n  const app = express();\n\n  //setup compression\n  if (cfg.compression && cfg.compression.enable) {\n    const options = cfg.compression.options || {};\n    app.use((require('compression'))(options));\n  }\n\n  //setup static directories\n  if (cfg.static && cfg.static.dirs) {\n    const globalOptions = cfg.static.options;\n    cfg.static.dirs.forEach((dir, index) => {\n      const indexOptions = cfg.static[index] && cfg.static[index].options || {};\n      const options = _.merge({}, globalOptions, indexOptions);\n      app.use(express.static(dir, options));\n    });\n  }\n\n  if (cfg.body) {\n    if (cfg.body.json && !cfg.body.json.disable) {\n      app.use(bodyParser.json());\n    }\n\n    if (cfg.body.form && !cfg.body.form.disable) {\n      app.use(bodyParser.urlencoded());\n    }\n  }\n\n  if (cfg.cookie) {\n    if (!cfg.cookie.disable) {\n      console.log(\"enable cookie-parser\")\n      if (cfg.cookie.secret) {\n        app.use(cookieParser(cfg.cookie.secret));\n      } else {\n        app.use(cookieParser());\n      }\n    }\n  }\n\n  return app;\n}\n\nmodule.exports = init;\n"],"sourceRoot":"/Users/efuquen/Code/oss/entanglejs/entangled/src"}